TinyCore.Module.define("models_vidtop",[],function(){var t=lru(100);return{onStart:function(t){},getDataItem:function(t,e){var i=t+"."+e.id;return e.post={ID:i},e.href="#p/"+i,e.link="#p/"+i,e.content=e.text,e.post_id=i,e},getDataList:function(t,e){var i=this;i.getData(t,function(n){e(n.filter(function(t){return t}).map(function(e){return i.getDataItem(t,e)}))})},getPlayObj:function(t,e){var i=this;i.getData(t,function(t){i.getDataPlayDetail(t,e)})},getDataPlayDetail:function(t,e){t.player||(t.player=vidtop.config.player),this.getData(t.player,function(i){!function(t,e,i){var n=e.constructor===Array?e[0]:e;Object.assign(n.meta,{title:t.title,subTitle:t.subTitle}),n.preview={previewSeconds:"0",previewLink:"",previewTitle:"",previewDescription:""},n.options.type=t.src_type,n.options.code=t.src_play,i(n)}(t,i,e)})},_getDataHandler:function(t,e,i,n){var o=t.filter(function(t){return t.status});n(i?o.filter(function(t){return t.id==i})[0]:o)},getData:function(e,i){var n,o,r=this;if(/\./.test(e)){var a=e.split(".");n=a[1],o=a[0]}else o=e;var c="https://docs.google.com/spreadsheets/d/e/"+o+"/pub?output=csv",p=t.get(o);p?vidtop.config&&vidtop.config.player&&o==vidtop.config.player?r._getDataHandler(JSON.parse(p),e,n,i):r._getDataHandler(p,e,n,i):r._api(c,function(a){vidtop.config&&vidtop.config.player&&o==vidtop.config.player?t.set(o,JSON.stringify(a)):t.set(o,a),r._getDataHandler(a,e,n,i)})},_csvJSON:function(t){for(var e=[],i=t[0],n=1;n<t.length;n++){for(var o,r={},a=t[n],c=0;c<i.length;c++)o=a[c],objectPath.set(r,i[c],o);e.push(r)}return e},_api:function(t,e){function i(t){r=o();var i=a._csvJSON(t.data);e(i)}function n(t,e){r=o()}function o(){return void 0!==window.performance?window.performance.now():0}var r,a=this,c={delimiter:"",newline:"",quoteChar:'"',header:!1,dynamicTyping:!0,preview:0,encoding:"",worker:!1,comments:!1,skipEmptyLines:!1,chunk:void 0,fastMode:void 0,beforeFirstChunk:void 0,withCredentials:void 0,step:void 0,complete:i,error:n,download:!0};o();Papa.parse(t,c)}}});