TinyCore.Module.define("models_vidtop",[],function(){var t=lru(100);return{onStart:function(t){},getDataItem:function(t,e){var i=t+"."+e.id;return e.post={ID:i},e.href="#p/"+i,e.link="#p/"+i,e.content=e.text,e.post_id=i,e},getDataList:function(t,e){var i=this;i.getData(t,function(n){e(n.filter(function(t){return t}).map(function(e){return i.getDataItem(t,e)}))})},getPlayObj:function(t,e){var i=this;i.getData(t,function(t){i.getDataPlayDetail(t,e)})},getDataPlayDetail:function(t,e){function i(t,e,i){var n=e.constructor===Array?e[0]:e;if("youtube"==t.src_type){var o=t.src_play;Object.assign(n.meta,{title:t.title,subTitle:t.subTitle}),Object.assign(n,{codes:["https://www.youtube.com/watch?v="+o],poster:"https://img.youtube.com/vi/"+o+"/maxresdefault.jpg",preview:{previewSeconds:"0",previewLink:"",previewTitle:"",previewDescription:""}}),n.options.youtube=1,n.options.code=t.src_play}i(n)}var n=this;t.player||(t.player=vidtop.config.player),n.getData(t.player,function(n){i(t,n,e)})},_getDataHandler:function(t,e,i,n){var o=t.filter(function(t){return t.status});n(i?o.filter(function(t){return t.id==i})[0]:o)},getData:function(e,i){var n,o,a=this;if(/\./.test(e)){var r=e.split(".");n=r[1],o=r[0]}else o=e;var c="https://docs.google.com/spreadsheets/d/e/"+o+"/pub?output=csv",p=t.get(o);p?vidtop.config&&vidtop.config.player&&o==vidtop.config.player?a._getDataHandler(JSON.parse(p),e,n,i):a._getDataHandler(p,e,n,i):a._api(c,function(r){vidtop.config&&vidtop.config.player&&o==vidtop.config.player?t.set(o,JSON.stringify(r)):t.set(o,r),a._getDataHandler(r,e,n,i)})},_csvJSON:function(t){for(var e=[],i=t[0],n=1;n<t.length;n++){for(var o,a={},r=t[n],c=0;c<i.length;c++)o=r[c],objectPath.set(a,i[c],o);e.push(a)}return e},_api:function(t,e){function i(t){}function n(t){r=a(),i("Parse complete");var n=c._csvJSON(t.data);e(n)}function o(t,e){r=a()}function a(){return void 0!==window.performance?window.performance.now():0}var r,c=this,p={delimiter:"",newline:"",quoteChar:'"',header:!1,dynamicTyping:!0,preview:0,encoding:"",worker:!1,comments:!1,skipEmptyLines:!1,chunk:void 0,fastMode:void 0,beforeFirstChunk:void 0,withCredentials:void 0,step:void 0,complete:n,error:o,download:!0};a();Papa.parse(t,p)}}});