TinyCore.Module.define("models_vidtop",[],function(){var t=lru(100);return{onStart:function(t){},getDataItem:function(t,e){var i=t+"."+e.id;return e.post={ID:i},e.href="#p/"+i,e.link="#p/"+i,e.content=e.text,e.post_id=i,e},getDataList:function(t,e){var i=this;i.getData(t,function(n){e(n.filter(function(t){return t}).map(function(e){return i.getDataItem(t,e)}))})},getPlayObj:function(t,e){var i=this;if(t){var n=t.split("."),o=n[0],r=n[1];i.getData(o,function(t){var n=t.filter(function(t){return t.id==r})[0];i.getDataPlayDetail(n,e)})}else e()},getDataPlayDetail:function(t,e){this.getData(t.player,function(i){var n=i.constructor===Array?i[0]:i;if("youtube"==t.src_type){var o=t.src_play;Object.assign(n.meta,{title:t.title,subTitle:t.subTitle}),Object.assign(n,{codes:["https://www.youtube.com/watch?v="+o],poster:"https://img.youtube.com/vi/"+o+"/maxresdefault.jpg",preview:{previewSeconds:"0",previewLink:"",previewTitle:"",previewDescription:""}}),n.options.youtube=1,n.options.code=t.src_play}e(n)})},_getDataHandler:function(t,e,i,n){var o=t.filter(function(t){return t.status});n(i?o.filter(function(t){return t.id==i}):o)},getData:function(e,i){var n,o,r=this;if(/\./.test(e)){var a=e.split(".");n=a[1],o=a[0]}else o=e;var c="https://docs.google.com/spreadsheets/d/e/"+o+"/pub?output=csv",s=t.get(o);s?vidtop.config&&vidtop.config.player&&o==vidtop.config.player?r._getDataHandler(JSON.parse(s),e,n,i):r._getDataHandler(s,e,n,i):r._api(c,function(a){vidtop.config&&vidtop.config.player&&o==vidtop.config.player?t.set(o,JSON.stringify(a)):t.set(o,a),r._getDataHandler(a,e,n,i)})},_csvJSON:function(t){for(var e=[],i=t[0],n=1;n<t.length;n++){for(var o,r={},a=t[n],c=0;c<i.length;c++)o=a[c],objectPath.set(r,i[c],o);e.push(r)}return e},_api:function(t,e){function i(t){}function n(t){a=r(),i("Parse complete");var n=c._csvJSON(t.data);e(n)}function o(t,e){a=r()}function r(){return void 0!==window.performance?window.performance.now():0}var a,c=this,s={delimiter:"",newline:"",quoteChar:'"',header:!1,dynamicTyping:!0,preview:0,encoding:"",worker:!1,comments:!1,skipEmptyLines:!1,chunk:void 0,fastMode:void 0,beforeFirstChunk:void 0,withCredentials:void 0,step:void 0,complete:n,error:o,download:!0};r();Papa.parse(t,s)}}});