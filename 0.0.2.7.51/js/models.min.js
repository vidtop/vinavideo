TinyCore.Module.define("models_vidtop",[],function(){var t=lru(100),e=function(t,r){var n=Object.prototype.toString.call(t);if(n!==Object.prototype.toString.call(r))return!1;if(["[object Array]","[object Object]"].indexOf(n)<0)return!1;var i="[object Array]"===n?t.length:Object.keys(t).length;if(i!==("[object Array]"===n?r.length:Object.keys(r).length))return!1;var o=function(t,r){var n=Object.prototype.toString.call(t);if(["[object Array]","[object Object]"].indexOf(n)>=0){if(!e(t,r))return!1}else{if(n!==Object.prototype.toString.call(r))return!1;if("[object Function]"===n){if(t.toString()!==r.toString())return!1}else if(t!==r)return!1}};if("[object Array]"===n){for(var a=0;a<i;a++)if(!1===o(t[a],r[a]))return!1}else for(var c in t)if(t.hasOwnProperty(c)&&!1===o(t[c],r[c]))return!1;return!0},r=function(t){for(var e=[],r=t[0],n=1;n<t.length;n++){for(var i,o={},a=t[n],c=0;c<r.length;c++)i=a[c],objectPath.set(o,r[c],i);e.push(o)}return e},n=function(t,e){function n(t){a=o();var n=r(t.data);e(n)}function i(t,e){a=o()}function o(){return void 0!==window.performance?window.performance.now():0}var a,c={delimiter:"",newline:"",quoteChar:'"',header:!1,dynamicTyping:!0,preview:0,encoding:"",worker:!1,comments:!1,skipEmptyLines:!1,chunk:void 0,fastMode:void 0,beforeFirstChunk:void 0,withCredentials:void 0,step:void 0,complete:n,error:i,download:!0};o();Papa.parse(t,c)};return $LAB.script("http://rawgit.com/kidh0/jquery.idle/master/vanilla.idle.min.js").wait(function(){window.idle({onIdle:function(){for(var r=t.last;r;){n("https://docs.google.com/spreadsheets/d/e/"+r+"/pub?output=csv",function(n){var i=t.get(r);n&&!e(n,i)&&(vidtop.config&&vidtop.config.player&&r==vidtop.config.player?t.set(r,JSON.stringify(n)):t.set(r,n))}),r=t.cache[r].next}},idle:3e4,keepTracking:!0}).start()}),{onStart:function(t){},getCache:function(){return t},getDataItem:function(t,e){var r=t+"."+e.id;return e.post={ID:r},e.href="#p/"+r,e.link="#p/"+r,e.content=e.text,e.post_id=r,e},getDataList:function(t,e){var r=this;r.getData(t,function(n){e(n.filter(function(t){return t}).map(function(e){return r.getDataItem(t,e)}))})},getPlayObj:function(t,e){var r=this;r.getData(t,function(t){r.getDataPlayDetail(t,e)})},getDataPlayDetail:function(t,e){t.player||(t.player=vidtop.config.player),this.getData(t.player,function(r){!function(t,e,r){var n=e.constructor===Array?e[0]:e;Object.assign(n.meta,{title:t.title,subTitle:t.subTitle}),n.preview={previewSeconds:"0",previewLink:"",previewTitle:"",previewDescription:""},n.options.type=t.src_type,n.options.code=t.src_play,r(n)}(t,r,e)})},_getDataHandler:function(t,e,r,n){var i=t.filter(function(t){return t.status});n(r?i.filter(function(t){return t.id==r})[0]:i)},getData:function(e,r){var n,i,o=this;if(/\./.test(e)){var a=e.split(".");n=a[1],i=a[0]}else i=e;var c="https://docs.google.com/spreadsheets/d/e/"+(i=i.replace(/---/g,"_").replace(".html",""))+"/pub?output=csv",p=t.get(i);p?vidtop.config&&vidtop.config.player&&i==vidtop.config.player?o._getDataHandler(JSON.parse(p),e,n,r):o._getDataHandler(p,e,n,r):o._api(c,function(a){vidtop.config&&vidtop.config.player&&i==vidtop.config.player?t.set(i,JSON.stringify(a)):t.set(i,a),o._getDataHandler(a,e,n,r)})},_csvJSON:r,_api:n}});